# unityeditor-launcher [![Build Status](https://magnum.travis-ci.com/UnityTech/unityeditor-launcher.svg?token=rsGNoUBdJ2xNNMbKPntd)](https://magnum.travis-ci.com/UnityTech/unityeditor-launcher) [![Coverage Status](https://coveralls.io/repos/UnityTech/unityeditor-launcher/badge.svg?branch=dev&service=github&t=oZG9hg)](https://coveralls.io/github/UnityTech/unityeditor-launcher?branch=dev)

Unity's Home Window.  based on [unityeditor-cloud-starter](https://github.com/UnityTech/unityeditor-cloud-starter)

## Owner ##

Paolo Gavazzi (paolo@unity3d.com)

## Quick Start

#### Installation

```sh
# Clone the repository
$ git clone git@github.com:UnityTech/unityeditor-launcher.git

# Make Sure you have the latest bower/npm
$ sudo npm cache clean
$ npm update -g bower
$ sudo npm install -g npm

# Install global dependencies
$ sudo npm -g install grunt-cli karma bower

$ cd unityeditor-launcher

$ npm install
$ bower install
$ grunt
```

The last grunt command will start a copy the required files in the dist folder and can be use for development purpose.  

#### Running Tests

```sh
$ grunt test
# This will generate a code coverage report. Instructions on viewing it are displayed in the result text.
```

#### Unity Javascript Package Repository

Unity now uses {UserData}/Packages/package.json to specify the required javascript packages

#### Using npm link to develop Home Window features

```sh
$ cd unityeditor-launcher

# this will register your current project folder as the location of the unity-editor-home location
$ npm link

$ cd {UserData}/Packages

# this creates a symbolic link to your dev folder for the unity-editor-home package
$ npm link unity-editor-home

$ grunt build    # to build ALL files
$ grunt watch    # to continuously update changes
```

<img src="wiki/package-load-flow.png" alt="Load Flow" style="max-width: 400px;"/>

#### Pull Request approval process

In order to be accepted, your PR to the "dev" branch must go through the same approval process as code that's commited to our Mercurial editor/collab/staging branch. Here are the steps to follow:

###### A. Prerequisites
0. Setup for checking out/committing to the Mercurial Unity repository: https://confluence.hq.unity3d.com/display/DEV/Development+Setup
0. Get access to our MyGet npm packages repository (ask @pgavazzi)

##### Create Pull Requests in both repositories

###### B. Create Pull Request in the unityeditor-launcher git repo:
0. Before submitting your PR, increment the version field in the package.json of each modified package to a prerelease version. The current convention to avoid overwriting other people's packages is to append the branch name as a prerelease tag.
    - For instance, if the current version is {"version": "0.0.16"} and your branch name is `my_awesome_fix`, update the version to {"version": "0.0.17-my_awesome_fix.1"}.
    - Version strings must be parseable by https://github.com/npm/node-semver.
0. Submit your PR. Travis will automatically publish packages that have a prerelease version to MyGet, and will skip publishing packages with release versions (it will still build them for verification purposes).
0. Add reviewers by mentioning them with @name in the description or a comment, including QA.
    - To make the notification emails stand out, it's highly recommended to cut down on the github spam by unwatching every repository and setting "Automatically watch repositories " to off in the Notification center. You'll still be notified when participating or @mentioned.
0. Download your prerelease packages from MyGet.

###### C. Create Pull Request in the unity mercurial repo:
0. Prepare a PR branch off editor/collab/staging. Copy the packages downloaded from MyGet into External/Packages, deleting older packages. Add the packages to mercurial as *largefiles* (`hg add --large`)
    - you can configure the largefiles extension to automatically consider .tgz as largefiles: https://www.mercurial-scm.org/wiki/LargefilesExtension#Overview.
0. Update External/Packages/package.json to depend on your new packages. For instance, if your package is `unityeditor-launcher.0.0.17-my_awesome_fix.1.tgz`, set {"unityeditor-launcher": "~0.0.17-my_awesome_fix.1"} in package.json.
    - For more info about npm's semantic versioning i.e. how npm actually matches what you put in package.json to ranges of package versions, see http://semver.npmjs.com/.
0. Push your branch and submit your PR on Ono. Ensure you follow all verification steps on your end, i.e. build, run all native tests, test likely affected areas in the editor, run the RAT, start Windows/Mac Editor Katana builds. Bring on reviewers and QA.
    - If you have used "npm link" to point the Unity editor to your javascript source, you need to delete those symlinks before launching Unity, or it won't install the packages you just produced.

If you need to update your PR, repeat the steps above as needed. You can choose to keep the same version number, which will overwrite your dev package on MyGet and save space, or increment it to generate new packages: `0.0.17-my_awesome_fix.2`, `0.0.17-my_awesome_fix.3`, and so on.

##### Final steps once both PRs are approved

For the merge to the git "dev" branch and the mercurial "editor/collab/staging" branch, your packages must be set back to release versions:

###### D. Produce release packages

0. *Ensure your git feature branch is up-to-date with the "dev" branch, or the version won't be updated correctly.* If not up-to-date, merge "dev" into your branch.
    - rebasing isn't advised at this point since for traceability, we don't want to lose the commit the tested packages came from.
0. Bump the version of each modified project by using `npm version patch` in their folder. The correct folder is the one containing the package.json.
    - `npm version patch` will bump `0.0.16 -> 0.0.17` and `0.0.17-my_awesome_fix.1 -> 0.0.17`
    - ensure that the result is that you're one patch version above the latest version used in "dev".
    - Note that **doesn't currently apply** to unityeditor-launcher: for packages that have their dedicated repo, `npm version` will automatically commit to your current branch and `git tag` the revision. In that case, in addition to pushing your commits, push the version tag using `git push origin <tag_name>` (info on pushing tags: http://stackoverflow.com/questions/5195859/push-a-tag-to-a-remote-repository-using-git)
0. Update your GitHub PR and merge to "dev" branch.
    - The comment for the merge commit should be the URL of the pull request.
0. Travis will pick up your merge commit in the "dev" branch and upload new packages to MyGet. (Our Travis scripts will block release packages from being overwritten, so packages whose version did not change won't be reuploaded.)

###### E. Commit release packages

0. Download the release packages, commit them (as largefiles) to External/Packages in your Mercurial PR branch, replacing your prerelease ones. Update External/Packages/package.json accordingly to match the new version of your packages: `unityeditor-launcher.0.0.17.tgz` would require {"unityeditor-launcher": "~0.0.17"}.
0. Merge your PR branch to editor/collab/staging. Before pushing, ensure you build, run native tests, and ensure the editor can open a project. An additional sanity check is also recommended to ensure that the packages you're adding are the same (except for the version) as the prerelease ones you got tested by QA.
    - The comment for the merge commit should be the URL of the pull request.

#### Additional Information

see [unityeditor-cloud-starter readme](https://github.com/UnityTech/unityeditor-cloud-starter/blob/trunk/README.md) for more details on the stucture of the project.

Happy hacking!
